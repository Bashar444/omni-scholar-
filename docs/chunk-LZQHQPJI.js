import{$b as x,Bb as p,Cb as f,Db as h,Eb as u,Mc as v,Qb as y,Rb as b,Uc as k,_b as S,a as c,eb as l,la as m}from"./chunk-SGQIVBNU.js";var D=class i{APP_VERSION="1.0.0";exportAllData(t){try{let n=this.collectAllLocalStorageData(),e={exportDate:new Date,appVersion:this.APP_VERSION,modules:n};this.downloadJSON(e,`omnischolar-${t}-backup-${this.getTimestamp()}.json`)}catch(n){throw console.error("Export failed:",n),new Error("Failed to export data. Please try again.")}}exportModuleData(t,n){try{let e={exportDate:new Date,appVersion:this.APP_VERSION,modules:{[t]:n}};this.downloadJSON(e,`omnischolar-${t}-${this.getTimestamp()}.json`)}catch(e){throw console.error("Module export failed:",e),new Error(`Failed to export ${t} data. Please try again.`)}}async importData(t,n={merge:!1}){try{let e=await this.readJSONFile(t);if(!this.isValidExportData(e))return{success:!1,message:"Invalid file format. Please select a valid OmniScholar backup file.",modulesImported:[]};let o=e,r=[],a=[];for(let[s,d]of Object.entries(o.modules))try{n.merge?this.mergeModuleData(s,d):this.replaceModuleData(s,d),r.push(s)}catch(g){a.push(`${s}: ${g instanceof Error?g.message:"Unknown error"}`)}return{success:r.length>0,message:r.length>0?`Successfully imported ${r.length} module(s)`:"No data was imported",modulesImported:r,errors:a.length>0?a:void 0}}catch(e){return{success:!1,message:e instanceof Error?e.message:"Failed to import data",modulesImported:[]}}}collectAllLocalStorageData(){let t={};return["paper-pilot","omni-ai","lab-sync","citation-network","library"].forEach(e=>{let o=this.getModuleDataFromStorage(e);o&&(t[e]=o)}),t}getModuleDataFromStorage(t){try{let n=[`${t}-data`,t,`omnischolar-${t}`,`omni_${t}`],e={};n.forEach(o=>{let r=localStorage.getItem(o);if(r)try{e[o]=JSON.parse(r)}catch{e[o]=r}});for(let o=0;o<localStorage.length;o++){let r=localStorage.key(o);if(r&&r.toLowerCase().includes(t.toLowerCase())&&!e[r]){let a=localStorage.getItem(r);if(a)try{e[r]=JSON.parse(a)}catch{e[r]=a}}}return Object.keys(e).length>0?e:null}catch(n){return console.error(`Failed to get ${t} data:`,n),null}}replaceModuleData(t,n){this.clearModuleData(t);for(let[e,o]of Object.entries(n))try{let r=typeof o=="string"?o:JSON.stringify(o);localStorage.setItem(e,r)}catch(r){console.error(`Failed to restore ${e}:`,r)}}mergeModuleData(t,n){for(let[e,o]of Object.entries(n))try{let r=localStorage.getItem(e);if(r&&typeof o=="object"&&!Array.isArray(o)){let a=JSON.parse(r),s=c(c({},a),o);localStorage.setItem(e,JSON.stringify(s))}else if(r&&Array.isArray(o)){let a=JSON.parse(r),s=this.mergeArrays(a,o);localStorage.setItem(e,JSON.stringify(s))}else{let a=typeof o=="string"?o:JSON.stringify(o);localStorage.setItem(e,a)}}catch(r){console.error(`Failed to merge ${e}:`,r)}}mergeArrays(t,n){if(t.length>0&&"id"in t[0]){let o=new Map;return[...t,...n].forEach(r=>{r.id&&o.set(r.id,r)}),Array.from(o.values())}return[...t,...n]}clearModuleData(t){let n=[];for(let e=0;e<localStorage.length;e++){let o=localStorage.key(e);o&&o.toLowerCase().includes(t.toLowerCase())&&n.push(o)}n.forEach(e=>localStorage.removeItem(e))}downloadJSON(t,n){let e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),o=URL.createObjectURL(e),r=document.createElement("a");r.href=o,r.download=n,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)}readJSONFile(t){return new Promise((n,e)=>{if(!t.name.endsWith(".json")){e(new Error("Please select a JSON file"));return}let o=new FileReader;o.onload=r=>{try{let a=JSON.parse(r.target?.result);n(a)}catch{e(new Error("Invalid JSON file"))}},o.onerror=()=>{e(new Error("Failed to read file"))},o.readAsText(t)})}isValidExportData(t){return t&&typeof t=="object"&&"exportDate"in t&&"appVersion"in t&&"modules"in t&&typeof t.modules=="object"}getTimestamp(){return new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}clearAllData(){confirm("Are you sure you want to clear ALL data? This action cannot be undone!")&&(localStorage.clear(),alert("All data has been cleared. Please refresh the page."))}static \u0275fac=function(n){return new(n||i)};static \u0275prov=m({token:i,factory:i.\u0275fac,providedIn:"root"})};var P=["mat-internal-form-field",""],C=["*"],E=(()=>{class i{labelPosition;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=l({type:i,selectors:[["div","mat-internal-form-field",""]],hostAttrs:[1,"mdc-form-field","mat-internal-form-field"],hostVars:2,hostBindings:function(e,o){e&2&&x("mdc-form-field--align-end",o.labelPosition==="before")},inputs:{labelPosition:"labelPosition"},attrs:P,ngContentSelectors:C,decls:1,vars:0,template:function(e,o){e&1&&(y(),b(0))},styles:[`.mat-internal-form-field{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:inline-flex;align-items:center;vertical-align:middle}.mat-internal-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mat-internal-form-field>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end .mdc-form-field--align-end label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0}
`],encapsulation:2,changeDetection:0})}return i})();var O=class i{type="rectangle";width="100%";height="auto";static \u0275fac=function(n){return new(n||i)};static \u0275cmp=l({type:i,selectors:[["app-skeleton-loader"]],inputs:{type:"type",width:"width",height:"height"},decls:2,vars:5,consts:[[1,"skeleton-loader",3,"ngClass"],[1,"skeleton-shimmer"]],template:function(n,e){n&1&&(f(0,"div",0),u(1,"div",1),h()),n&2&&(S("width",e.width)("height",e.height),p("ngClass","skeleton-"+e.type))},dependencies:[k,v],styles:[".skeleton-loader[_ngcontent-%COMP%]{background:linear-gradient(90deg,#f0f0f0,#f8f8f8,#f0f0f0);background-size:200% 100%;border-radius:4px;position:relative;overflow:hidden;animation:_ngcontent-%COMP%_shimmer 1.5s ease-in-out infinite}@keyframes _ngcontent-%COMP%_shimmer{0%{background-position:200% 0}to{background-position:-200% 0}}.skeleton-shimmer[_ngcontent-%COMP%]{position:absolute;inset:0;background:linear-gradient(90deg,#fff0,#ffffff80,#fff0);animation:_ngcontent-%COMP%_shimmer-slide 1.5s ease-in-out infinite}@keyframes _ngcontent-%COMP%_shimmer-slide{0%{transform:translate(-100%)}to{transform:translate(100%)}}.skeleton-card[_ngcontent-%COMP%]{min-height:200px;border-radius:8px}.skeleton-list-item[_ngcontent-%COMP%]{min-height:60px;margin-bottom:8px}.skeleton-text[_ngcontent-%COMP%]{height:16px;margin-bottom:8px}.skeleton-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%}.skeleton-circle[_ngcontent-%COMP%]{border-radius:50%}.skeleton-rectangle[_ngcontent-%COMP%]{border-radius:4px}"]})};export{E as a,D as b,O as c};
