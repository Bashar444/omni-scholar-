import{Qa as l,Rc as f,a as i,b as o,la as c,qa as d}from"./chunk-6XV5UQWZ.js";var h=class n{platformId=d(l);isBrowser=f(this.platformId);key="sg.library.v2";cache=new Map;constructor(){this.load()}load(){if(this.isBrowser)try{let e=window.localStorage.getItem(this.key),t=!1;if(e||(e=window.localStorage.getItem("sg.library.v1"),t=!0),e){let s=JSON.parse(e).map(r=>o(i({},r),{savedAt:r.savedAt?new Date(r.savedAt):new Date,tags:r.tags||[],notes:r.notes||"",folder:r.folder||void 0}));this.cache=new Map(s.map(r=>[this.mkKey(r),r])),t&&(this.persist(),window.localStorage.removeItem("sg.library.v1"))}}catch{}}persist(){if(this.isBrowser)try{let e=Array.from(this.cache.values());window.localStorage.setItem(this.key,JSON.stringify(e))}catch{}}mkKey(e){return`${e.source}:${e.id}`}isSaved(e){return this.cache.has(this.mkKey(e))}toggle(e){let t=this.mkKey(e);if(this.cache.has(t))return this.cache.delete(t),this.persist(),!1;let a=o(i({},e),{savedAt:new Date,tags:[],notes:"",folder:void 0});return this.cache.set(t,a),this.persist(),!0}updateMetadata(e,t){let a=this.mkKey(e),s=this.cache.get(a);if(!s)return;let r=o(i({},s),{tags:t.tags!==void 0?t.tags:s.tags,folder:t.folder!==void 0?t.folder:s.folder,notes:t.notes!==void 0?t.notes:s.notes});this.cache.set(a,r),this.persist()}list(){return Array.from(this.cache.values())}static \u0275fac=function(t){return new(t||n)};static \u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"})};export{h as a};
