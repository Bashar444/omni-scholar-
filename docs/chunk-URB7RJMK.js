import{c as H}from"./chunk-IY43AWBL.js";import{Dc as a,E as j,F as b,Fa as w,La as R,Na as B,Oc as M,Rc as G,Sa as O,Ta as P,Ua as L,Xa as C,Za as F,bb as g,cb as _,db as S,ed as Z,f as T,fd as z,hb as U,i as h,ib as D,j as N,jd as c,ka as f,kd as $,la as p,ld as d,oa as k,p as u,pa as s,sa as A,uc as W,ya as E,za as v}from"./chunk-PEEDB4LE.js";var Y=class n{constructor(r,e){this.router=r;this.platformId=e;this.loadUserFromStorage()}currentUserSubject=new N(null);currentUser$=this.currentUserSubject.asObservable();isAuthenticated=w(!1);currentUser=w(null);loadUserFromStorage(){if(!a(this.platformId))return;let r=localStorage.getItem("omni_scholar_user");if(r)try{let e=JSON.parse(r);this.setUser(e)}catch(e){console.error("Failed to parse stored user:",e),this.clearUser()}}login(r,e){let t={id:"1",email:r,name:"Demo Researcher",role:"researcher",avatar:"https://via.placeholder.com/150"};return this.setUser(t),u(t)}register(r,e,t){let i={id:Date.now().toString(),email:r,name:t,role:"researcher"};return this.setUser(i),u(i)}logout(){this.clearUser(),this.router.navigate(["/"])}setUser(r){this.currentUserSubject.next(r),this.currentUser.set(r),this.isAuthenticated.set(!0),a(this.platformId)&&localStorage.setItem("omni_scholar_user",JSON.stringify(r))}clearUser(){this.currentUserSubject.next(null),this.currentUser.set(null),this.isAuthenticated.set(!1),a(this.platformId)&&localStorage.removeItem("omni_scholar_user")}getCurrentUser(){return this.currentUserSubject.value}isLoggedIn(){return this.isAuthenticated()}getToken(){return a(this.platformId)?localStorage.getItem("omni_scholar_token"):null}setToken(r){a(this.platformId)&&localStorage.setItem("omni_scholar_token",r)}clearToken(){a(this.platformId)&&localStorage.removeItem("omni_scholar_token")}static \u0275fac=function(e){return new(e||n)(k(H),k(B))};static \u0275prov=f({token:n,factory:n.\u0275fac,providedIn:"root"})};var ee=20,te=(()=>{class n{_ngZone=s(D);_platform=s(M);_renderer=s(P).createRenderer(null,null);_cleanupGlobalListener;constructor(){}_scrolled=new h;_scrolledCount=0;scrollContainers=new Map;register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){let t=this.scrollContainers.get(e);t&&(t.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=ee){return this._platform.isBrowser?new T(t=>{this._cleanupGlobalListener||(this._cleanupGlobalListener=this._ngZone.runOutsideAngular(()=>this._renderer.listen("document","scroll",()=>this._scrolled.next())));let i=e>0?this._scrolled.pipe(b(e)).subscribe(t):this._scrolled.subscribe(t);return this._scrolledCount++,()=>{i.unsubscribe(),this._scrolledCount--,this._scrolledCount||(this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0)}}):u()}ngOnDestroy(){this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0,this.scrollContainers.forEach((e,t)=>this.deregister(t)),this._scrolled.complete()}ancestorScrolled(e,t){let i=this.getAncestorScrollContainers(e);return this.scrolled(t).pipe(j(o=>!o||i.indexOf(o)>-1))}getAncestorScrollContainers(e){let t=[];return this.scrollContainers.forEach((i,o)=>{this._scrollableContainsElement(o,e)&&t.push(o)}),t}_scrollableContainsElement(e,t){let i=G(t),o=e.getElementRef().nativeElement;do if(i==o)return!0;while(i=i.parentElement);return!1}static \u0275fac=function(t){return new(t||n)};static \u0275prov=f({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),dt=(()=>{class n{elementRef=s(R);scrollDispatcher=s(te);ngZone=s(D);dir=s(Z,{optional:!0});_scrollElement=this.elementRef.nativeElement;_destroyed=new h;_renderer=s(L);_cleanupScroll;_elementScrolled=new h;constructor(){}ngOnInit(){this._cleanupScroll=this.ngZone.runOutsideAngular(()=>this._renderer.listen(this._scrollElement,"scroll",e=>this._elementScrolled.next(e))),this.scrollDispatcher.register(this)}ngOnDestroy(){this._cleanupScroll?.(),this._elementScrolled.complete(),this.scrollDispatcher.deregister(this),this._destroyed.next(),this._destroyed.complete()}elementScrolled(){return this._elementScrolled}getElementRef(){return this.elementRef}scrollTo(e){let t=this.elementRef.nativeElement,i=this.dir&&this.dir.value=="rtl";e.left==null&&(e.left=i?e.end:e.start),e.right==null&&(e.right=i?e.start:e.end),e.bottom!=null&&(e.top=t.scrollHeight-t.clientHeight-e.bottom),i&&d()!=c.NORMAL?(e.left!=null&&(e.right=t.scrollWidth-t.clientWidth-e.left),d()==c.INVERTED?e.left=e.right:d()==c.NEGATED&&(e.left=e.right?-e.right:e.right)):e.right!=null&&(e.left=t.scrollWidth-t.clientWidth-e.right),this._applyScrollToOptions(e)}_applyScrollToOptions(e){let t=this.elementRef.nativeElement;$()?t.scrollTo(e):(e.top!=null&&(t.scrollTop=e.top),e.left!=null&&(t.scrollLeft=e.left))}measureScrollOffset(e){let t="left",i="right",o=this.elementRef.nativeElement;if(e=="top")return o.scrollTop;if(e=="bottom")return o.scrollHeight-o.clientHeight-o.scrollTop;let l=this.dir&&this.dir.value=="rtl";return e=="start"?e=l?i:t:e=="end"&&(e=l?t:i),l&&d()==c.INVERTED?e==t?o.scrollWidth-o.clientWidth-o.scrollLeft:o.scrollLeft:l&&d()==c.NEGATED?e==t?o.scrollLeft+o.scrollWidth-o.clientWidth:-o.scrollLeft:e==t?o.scrollLeft:o.scrollWidth-o.clientWidth-o.scrollLeft}static \u0275fac=function(t){return new(t||n)};static \u0275dir=_({type:n,selectors:[["","cdk-scrollable",""],["","cdkScrollable",""]]})}return n})(),re=20,ht=(()=>{class n{_platform=s(M);_listeners;_viewportSize;_change=new h;_document=s(v);constructor(){let e=s(D),t=s(P).createRenderer(null,null);e.runOutsideAngular(()=>{if(this._platform.isBrowser){let i=o=>this._change.next(o);this._listeners=[t.listen("window","resize",i),t.listen("window","orientationchange",i)]}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){this._listeners?.forEach(e=>e()),this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){let e=this.getViewportScrollPosition(),{width:t,height:i}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+i,right:e.left+t,height:i,width:t}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let e=this._document,t=this._getWindow(),i=e.documentElement,o=i.getBoundingClientRect(),l=-o.top||e.body.scrollTop||t.scrollY||i.scrollTop||0,X=-o.left||e.body.scrollLeft||t.scrollX||i.scrollLeft||0;return{top:l,left:X}}change(e=re){return e>0?this._change.pipe(b(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}static \u0275fac=function(t){return new(t||n)};static \u0275prov=f({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Q=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=g({type:n});static \u0275inj=p({})}return n})(),ut=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=g({type:n});static \u0275inj=p({imports:[z,Q,z,Q]})}return n})();var m=class{_attachedHost;attach(r){return this._attachedHost=r,r.attach(this)}detach(){let r=this._attachedHost;r!=null&&(this._attachedHost=null,r.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(r){this._attachedHost=r}},I=class extends m{component;viewContainerRef;injector;projectableNodes;constructor(r,e,t,i){super(),this.component=r,this.viewContainerRef=e,this.injector=t,this.projectableNodes=i}},y=class extends m{templateRef;viewContainerRef;context;injector;constructor(r,e,t,i){super(),this.templateRef=r,this.viewContainerRef=e,this.context=t,this.injector=i}get origin(){return this.templateRef.elementRef}attach(r,e=this.context){return this.context=e,super.attach(r)}detach(){return this.context=void 0,super.detach()}},V=class extends m{element;constructor(r){super(),this.element=r instanceof R?r.nativeElement:r}},x=class{_attachedPortal;_disposeFn;_isDisposed=!1;hasAttached(){return!!this._attachedPortal}attach(r){if(r instanceof I)return this._attachedPortal=r,this.attachComponentPortal(r);if(r instanceof y)return this._attachedPortal=r,this.attachTemplatePortal(r);if(this.attachDomPortal&&r instanceof V)return this._attachedPortal=r,this.attachDomPortal(r)}attachDomPortal=null;detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(r){this._disposeFn=r}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}},J=class extends x{outletElement;_appRef;_defaultInjector;constructor(r,e,t){super(),this.outletElement=r,this._appRef=e,this._defaultInjector=t}attachComponentPortal(r){let e;if(r.viewContainerRef){let t=r.injector||r.viewContainerRef.injector,i=t.get(F,null,{optional:!0})||void 0;e=r.viewContainerRef.createComponent(r.component,{index:r.viewContainerRef.length,injector:t,ngModuleRef:i,projectableNodes:r.projectableNodes||void 0}),this.setDisposeFn(()=>e.destroy())}else{let t=this._appRef,i=r.injector||this._defaultInjector||E.NULL,o=i.get(A,t.injector);e=W(r.component,{elementInjector:i,environmentInjector:o,projectableNodes:r.projectableNodes||void 0}),t.attachView(e.hostView),this.setDisposeFn(()=>{t.viewCount>0&&t.detachView(e.hostView),e.destroy()})}return this.outletElement.appendChild(this._getComponentRootNode(e)),this._attachedPortal=r,e}attachTemplatePortal(r){let e=r.viewContainerRef,t=e.createEmbeddedView(r.templateRef,r.context,{injector:r.injector});return t.rootNodes.forEach(i=>this.outletElement.appendChild(i)),t.detectChanges(),this.setDisposeFn(()=>{let i=e.indexOf(t);i!==-1&&e.remove(i)}),this._attachedPortal=r,t}attachDomPortal=r=>{let e=r.element;e.parentNode;let t=this.outletElement.ownerDocument.createComment("dom-portal");e.parentNode.insertBefore(t,e),this.outletElement.appendChild(e),this._attachedPortal=r,super.setDisposeFn(()=>{t.parentNode&&t.parentNode.replaceChild(e,t)})};dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(r){return r.hostView.rootNodes[0]}},Rt=(()=>{class n extends y{constructor(){let e=s(O),t=s(C);super(e,t)}static \u0275fac=function(t){return new(t||n)};static \u0275dir=_({type:n,selectors:[["","cdkPortal",""]],exportAs:["cdkPortal"],features:[S]})}return n})();var Ct=(()=>{class n extends x{_moduleRef=s(F,{optional:!0});_document=s(v);_viewContainerRef=s(C);_isInitialized=!1;_attachedRef;constructor(){super()}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e||null)}attached=new U;get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(e){e.setAttachedHost(this);let t=e.viewContainerRef!=null?e.viewContainerRef:this._viewContainerRef,i=t.createComponent(e.component,{index:t.length,injector:e.injector||t.injector,projectableNodes:e.projectableNodes||void 0,ngModuleRef:this._moduleRef||void 0});return t!==this._viewContainerRef&&this._getRootNode().appendChild(i.hostView.rootNodes[0]),super.setDisposeFn(()=>i.destroy()),this._attachedPortal=e,this._attachedRef=i,this.attached.emit(i),i}attachTemplatePortal(e){e.setAttachedHost(this);let t=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=t,this.attached.emit(t),t}attachDomPortal=e=>{let t=e.element;t.parentNode;let i=this._document.createComment("dom-portal");e.setAttachedHost(this),t.parentNode.insertBefore(i,t),this._getRootNode().appendChild(t),this._attachedPortal=e,super.setDisposeFn(()=>{i.parentNode&&i.parentNode.replaceChild(t,i)})};_getRootNode(){let e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}static \u0275fac=function(t){return new(t||n)};static \u0275dir=_({type:n,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[0,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[S]})}return n})();var St=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=g({type:n});static \u0275inj=p({})}return n})();export{Y as a,te as b,dt as c,ht as d,Q as e,ut as f,I as g,y as h,J as i,Rt as j,Ct as k,St as l};
