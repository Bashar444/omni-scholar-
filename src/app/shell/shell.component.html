<!-- Main Layout Container -->
<div class="shell-container">

  <!-- Sidebar -->
  <p-sidebar [visible]="sidenavOpened()" (visibleChange)="sidenavOpened.set($event)" position="left" [baseZIndex]="10000" [showCloseIcon]="false" class="sidenav">
    <div class="sidenav-header">
      <div class="logo-container">
        <i class="pi pi-hashtag logo-icon"></i>
        <h2 class="logo-text">OmniScholar</h2>
      </div>
      <p class="tagline">The Angular-powered Research Universe</p>
    </div>

    <!-- Navigation List -->
    <div class="nav-list">
      <a
        *ngFor="let module of modules"
        class="nav-item"
        [routerLink]="module.route"
        routerLinkActive="active"
        pTooltip="{{ module.description }}"
        tooltipPosition="right"
        [ngClass]="{ active: router.isActive(module.route, false) }"
      >
        <i [class]="module.icon + ' nav-icon'"></i>
        <span class="nav-text">{{ module.name }}</span>
      </a>
    </div>

    <!-- Sidebar Footer -->
    <div class="sidenav-footer">
      <p-divider></p-divider>

      <div class="user-info">
        <i class="pi pi-user"></i>
        <span *ngIf="authService.currentUser() as user">{{ user.name }}</span>
        <span *ngIf="!authService.currentUser()">Guest</span>
      </div>

      <div class="auth-cta" *ngIf="!authService.currentUser()">
        <p-button
          label="Sign In"
          icon="pi pi-sign-in"
          (onClick)="navigateTo('/auth')"
          styleClass="p-button-outlined p-button-primary"
        ></p-button>
      </div>
    </div>
  </p-sidebar>

  <!-- Top Toolbar -->
  <p-toolbar class="app-toolbar">
    <div class="p-toolbar-group-left">
      <p-button icon="pi pi-bars" class="p-button-text" (onClick)="toggleSidenav()" tooltip="Toggle Menu"></p-button>
    </div>

    <div class="p-toolbar-group-center">
      <div class="search-container">
        <i class="pi pi-search search-icon"></i>
        <input
          pInputText
          type="text"
          placeholder="Search across all modules..."
          class="search-input"
        />
      </div>
    </div>

    <div class="p-toolbar-group-right">
      <!-- Notifications -->
      <p-overlayPanel #notifications>
        <div class="notification-header">
          <h3>Notifications</h3>
        </div>
        <p-divider></p-divider>
        <div class="notification-item">
          <i class="pi pi-info-circle"></i>
          <span>New paper matching your interests</span>
        </div>
        <div class="notification-item">
          <i class="pi pi-comments"></i>
          <span>Team message in LabSync</span>
        </div>
        <div class="notification-item">
          <i class="pi pi-dollar"></i>
          <span>Grant deadline approaching</span>
        </div>
      </p-overlayPanel>

      <p-button
        icon="pi pi-bell"
        styleClass="p-button-text"
        (onClick)="notifications.toggle($event)"
        tooltip="Notifications"
      >
        <p-badge value="3" severity="danger"></p-badge>
      </p-button>

      <!-- User Menu -->
      <p-tieredMenu #userMenu [model]="userMenuItems()" [popup]="true" [autoDisplay]="false"></p-tieredMenu>
      <p-avatar 
        *ngIf="authService.currentUser() as user"
        [label]="user.name[0].toUpperCase()"
        shape="circle"
        (onClick)="userMenu.toggle($event)"
        class="p-overlay-badge cursor-pointer"
        styleClass="user-avatar"
      >
      </p-avatar>

      <p-button
        icon="pi pi-user"
        styleClass="p-button-text"
        (onClick)="userMenu.toggle($event)"
        tooltip="User Menu"
      ></p-button>
    </div>
  </p-toolbar>

  <!-- Main Content -->
  <div class="content-container">
    <router-outlet></router-outlet>
  </div>
</div>
