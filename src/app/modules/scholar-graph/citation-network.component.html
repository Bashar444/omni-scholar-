<div class="citation-network-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <i class="pi pi-sitemap header-icon"></i>
      <div class="header-text">
        <h1>Citation Network</h1>
        <p>Visualize research paper relationships and citation patterns</p>
      </div>
    </div>
  </div>

  <!-- Visualization Section -->
  <div class="visualization-section">
    <!-- Graph -->
    <p-card class="graph-card">
      <div class="loading-overlay" *ngIf="isLoading()">
        <i class="pi pi-spin pi-spinner loading-icon"></i>
        <p>Building citation network...</p>
      </div>
      
      <div #svgContainer class="svg-container"></div>

      <!-- Zoom Controls -->
      <div class="zoom-controls">
        <button pButton icon="pi pi-search" 
                (click)="zoomIn()" 
                class="zoom-btn"
                pTooltip="Zoom In">
        </button>
        <button pButton icon="pi pi-search-minus" 
                (click)="zoomOut()" 
                class="zoom-btn"
                pTooltip="Zoom Out">
        </button>
        <button pButton icon="pi pi-refresh" 
                (click)="resetZoom()" 
                class="zoom-btn"
                pTooltip="Reset View">
        </button>
      </div>
    </p-card>

    <!-- Statistics -->
    <p-card class="stats-card" *ngIf="statistics()">
      <ng-template pTemplate="header">
        <div class="flex align-items-center gap-2">
          <i class="pi pi-chart-bar text-xl"></i>
          <h3 class="m-0">Network Statistics</h3>
        </div>
      </ng-template>
      
      <div class="stat-grid">
        <div class="stat-item">
          <i class="pi pi-chart-scatter-plot"></i>
          <div class="stat-content">
            <span class="stat-value">{{ statistics()!.totalNodes }}</span>
            <span class="stat-label">Papers</span>
          </div>
        </div>

        <div class="stat-item">
          <i class="pi pi-link"></i>
          <div class="stat-content">
            <span class="stat-value">{{ statistics()!.totalLinks }}</span>
            <span class="stat-label">Citations</span>
          </div>
        </div>

        <div class="stat-item">
          <i class="pi pi-star"></i>
          <div class="stat-content">
            <span class="stat-value">{{ statistics()!.averageCitations.toFixed(1) }}</span>
            <span class="stat-label">Avg Citations</span>
          </div>
        </div>
      </div>

      <div class="most-cited" *ngIf="statistics()!.mostCitedPaper">
        <h4>Most Cited Paper</h4>
        <p class="paper-title">{{ statistics()!.mostCitedPaper.title }}</p>
        <p class="paper-meta">{{ statistics()!.mostCitedPaper.authors.join(', ') }} ({{ statistics()!.mostCitedPaper.year }})</p>
        <p class="paper-citations">
          <i class="pi pi-book"></i>
          {{ formatNumber(statistics()!.mostCitedPaper.citations) }} citations
        </p>
      </div>
    </p-card>

    <!-- Selected Node Details -->
    <p-card class="details-card" *ngIf="selectedNode()">
      <ng-template pTemplate="header">
        <div class="p-d-flex p-ai-center p-jc-between w-full">
          <div class="p-d-flex p-ai-center gap-2">
            <i class="pi pi-file-pdf text-xl"></i>
            <h3 class="m-0">Paper Details</h3>
          </div>
          <p-button icon="pi pi-times" 
                  (click)="clearSelection()" 
                  styleClass="p-button-text p-button-rounded"
                  pTooltip="Close">
          </p-button>
        </div>
      </ng-template>

      <div class="paper-content p-4">
        <h3 class="paper-title mb-4">{{ selectedNode()!.title }}</h3>
        
        <div class="paper-info">
          <div class="info-item">
            <i class="pi pi-users"></i>
            <span>{{ selectedNode()!.authors.join(', ') }}</span>
          </div>

          <div class="info-item">
            <i class="pi pi-calendar"></i>
            <span>{{ selectedNode()!.year }}</span>
          </div>

          <div class="info-item">
            <i class="pi pi-book"></i>
            <span>{{ selectedNode()!.citations }} citations</span>
          </div>

          <div class="info-item" *ngIf="selectedNode()!.doi">
            <i class="pi pi-link"></i>
            <a [href]="'https://doi.org/' + selectedNode()!.doi" target="_blank">
              {{ selectedNode()!.doi }}
            </a>
          </div>
        </div>

        <div class="paper-abstract" *ngIf="selectedNode()!.abstract">
          <h4>Abstract</h4>
          <p>{{ selectedNode()!.abstract }}</p>
        </div>

        <div class="actions mt-4">
          <p-button icon="pi pi-share-alt" 
                   label="Show Citation Path"
                   (onClick)="highlightPath()"
                   severity="primary">
          </p-button>
        </div>
      </div>
    </p-card>

    <!-- Legend -->
    <p-card styleClass="legend-card">
      <ng-template pTemplate="header">
        <div class="flex align-items-center gap-2">
          <i class="pi pi-info-circle text-xl"></i>
          <h3 class="m-0">Legend</h3>
        </div>
      </ng-template>
      
      <div class="legend-content">
        <div class="legend-item">
          <div class="color-box center"></div>
          <span>Selected Paper</span>
        </div>
        <div class="legend-item">
          <div class="color-box highlighted"></div>
          <span>Highly Cited</span>
        </div>
        <div class="legend-item">
          <div class="color-box regular"></div>
          <span>Regular Papers</span>
        </div>
      </div>
    </p-card>
  </div>
</div>