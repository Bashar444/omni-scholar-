<div class="global-knowledge-bridge-container">
  <!-- Header -->
  <p-card class="header-card">
    <div class="header-content">
      <div class="header-text">
        <h1>
          <i class="pi pi-globe mr-2"></i>
          GlobalKnowledgeBridge
        </h1>
        <p>Cross-Language Research Platform</p>
      </div>
      <div class="language-selector">
        <p-dropdown 
          [ngModel]="selectedUserLanguage()"
          (ngModelChange)="selectedUserLanguage.set($event)"
          [options]="supportedLanguages" 
          optionLabel="name" 
          optionValue="code"
          [style]="{'width': '250px'}"
          placeholder="Select Your Language">
          <ng-template pTemplate="selectedItem" let-language>
            <span>{{ language.flag }} {{ language.name }}</span>
          </ng-template>
          <ng-template pTemplate="item" let-language>
            <span>{{ language.flag }} {{ language.name }} ({{ language.nativeName }})</span>
          </ng-template>
        </p-dropdown>
      </div>
    </div>
  </p-card>

  <!-- Statistics Dashboard -->
  <div class="stats-grid">
    <p-card class="stat-card">
      <div class="stat-content">
        <i class="pi pi-file stat-icon papers"></i>
        <div class="stat-info">
          <div class="stat-value">{{ paperStats().totalPapers }}</div>
          <div class="stat-label">Papers</div>
        </div>
      </div>
    </p-card>

    <p-card class="stat-card">
      <div class="stat-content">
        <i class="pi pi-globe stat-icon languages"></i>
        <div class="stat-info">
          <div class="stat-value">{{ supportedLanguages.length }}</div>
          <div class="stat-label">Languages</div>
        </div>
      </div>
    </p-card>

    <p-card class="stat-card">
      <div class="stat-content">
        <i class="pi pi-users stat-icon collaborations"></i>
        <div class="stat-info">
          <div class="stat-value">{{ collaborationStats().totalCollaborations }}</div>
          <div class="stat-label">Collaborations</div>
        </div>
      </div>
    </p-card>

    <p-card class="stat-card">
      <div class="stat-content">
        <i class="pi pi-star-fill stat-icon quality"></i>
        <div class="stat-info">
          <div class="stat-value">{{ paperStats().averageTranslationQuality | number:'1.1-1' }}</div>
          <div class="stat-label">Avg. Quality</div>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Main Content Tabs -->
  <p-card class="content-card">
    <p-tabView>
      <!-- Multilingual Papers Tab -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <i class="pi pi-file mr-2"></i>
          <span>Research Papers</span>
          <span class="tab-count">{{ papers().length }}</span>
        </ng-template>

        <div class="tab-content">
          <!-- Search and Filter Toolbar -->
          <div class="toolbar">
            <span class="p-input-icon-left p-input-icon-right w-full">
              <i class="pi pi-search"></i>
              <input 
                pInputText 
                class="w-full" 
                [ngModel]="searchQuery()" 
                (ngModelChange)="updateSearch($event)" 
                placeholder="Search across all languages..."
                type="text">
              @if (searchQuery()) {
                <i class="pi pi-times cursor-pointer" (click)="clearSearch()"></i>
              }
            </span>

            <p-multiSelect 
              [(ngModel)]="selectedLanguages" 
              [options]="supportedLanguages"
              (onChange)="searchPapers()"
              optionLabel="name" 
              optionValue="code"
              placeholder="Select Languages"
              [style]="{'minWidth': '200px'}"
              display="chip">
              <ng-template let-language pTemplate="item">
                <span>{{ language.flag }} {{ language.name }}</span>
              </ng-template>
            </p-multiSelect>

            <p-multiSelect 
              [(ngModel)]="selectedFields"
              [options]="researchFields"
              (onChange)="searchPapers()"
              placeholder="Select Fields"
              [style]="{'minWidth': '200px'}"
              display="chip">
            </p-multiSelect>

            <p-multiSelect 
              [(ngModel)]="selectedRegions"
              [options]="geographicRegions"
              (onChange)="searchPapers()"
              placeholder="Select Regions"
              [style]="{'minWidth': '200px'}"
              display="chip">
            </p-multiSelect>
          </div>

          <!-- Loading State -->
          @if (isLoading()) {
            <div class="loading-container">
              <p-progressSpinner [style]="{'width': '48px', 'height': '48px'}"></p-progressSpinner>
              <p>Loading papers...</p>
            </div>
          } @else if (filteredPapers().length === 0) {
            <div class="empty-state">
              <i class="pi pi-file text-4xl"></i>
              <h3>No Papers Found</h3>
              <p>Try adjusting your search filters</p>
              <p-button 
                (click)="clearSearch()" 
                icon="pi pi-refresh"
                label="Clear Filters">
              </p-button>
            </div>
          } @else {
            <div class="papers-grid">
              @for (paper of filteredPapers(); track paper.id) {
                <p-card class="paper-card">
                  <div class="paper-header">
                    <div class="language-badges">
                      @for (lang of paper.availableLanguages.slice(0, 5); track lang) {
                        <p-chip
                          [label]="getLanguageFlag(lang)"
                          [pTooltip]="getLanguageName(lang)"
                          class="language-chip">
                        </p-chip>
                      }
                      @if (paper.availableLanguages.length > 5) {
                        <p-chip
                          [label]="'+' + (paper.availableLanguages.length - 5)"
                          class="language-chip">
                        </p-chip>
                      }
                    </div>

                    @if (paper.openAccess) {
                      <p-chip icon="pi pi-lock-open" label="Open Access" class="open-access-chip"></p-chip>
                    }
                  </div>

                  <div class="paper-content">
                    <h3>{{ getPaperTitle(paper) }}</h3>
                    <p class="original-language">Original: {{ getLanguageFlag(paper.originalLanguage) }} {{ getLanguageName(paper.originalLanguage) }}</p>
                    <p class="abstract">{{ truncateText(getPaperAbstract(paper), 200) }}</p>

                    <div class="paper-meta">
                      <div class="meta-item">
                        <i class="pi pi-tag"></i>
                        <span>{{ paper.field }}</span>
                      </div>
                      <div class="meta-item">
                        <i class="pi pi-globe"></i>
                        <span>{{ paper.regions.join(', ') }}</span>
                      </div>
                      <div class="meta-item">
                        <i class="pi pi-calendar"></i>
                        <span>{{ formatDate(paper.publicationDate) }}</span>
                      </div>
                      <div class="meta-item">
                        <i class="pi pi-quote-left"></i>
                        <span>{{ paper.citations }} citations</span>
                      </div>
                    </div>

                    <div class="authors">
                      <strong>Authors:</strong>
                      @for (author of paper.authors.slice(0, 3); track author.id) {
                        <span class="author-name">{{ author.originalName }}</span>
                      }
                      @if (paper.authors.length > 3) {
                        <span class="author-more">+{{ paper.authors.length - 3 }} more</span>
                      }
                    </div>

                    <div class="translation-quality">
                      <span class="quality-label">Translation Quality:</span>
                      @for (lang of paper.availableLanguages.slice(0, 3); track lang) {
                        @if (paper.translationQuality[lang]?.score !== undefined) {
                          <p-chip
                            class="quality-chip"
                            [label]="getLanguageFlag(lang) + ' ' + paper.translationQuality[lang]!.score + '%'"
                            [style]="{'background-color': getTranslationQualityColor(paper.translationQuality[lang]!.score)}">
                          </p-chip>
                        }
                      }
                    </div>
                  </div>

                  <div class="paper-actions">
                    <p-button icon="pi pi-eye" label="View" (onClick)="viewPaper(paper)"></p-button>
                    <p-menu #menu [popup]="true" [model]="translateMenuItems()"></p-menu>
                    <p-button icon="pi pi-language" label="Translate" (onClick)="menu.toggle($event)"></p-button>
                    <p-button icon="pi pi-download" label="Download" (onClick)="downloadPaper(paper)"></p-button>
                  </div>
                </p-card>
              }
            </div>
          }
        </div>
        </p-tabPanel>

      <!-- Global Collaborations Tab -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <i class="pi pi-users mr-2"></i>
          <span>Collaborations</span>
          <p-badge [value]="collaborations().length.toString()" class="ml-2"></p-badge>
        </ng-template>

        <div class="tab-content">
          <div class="toolbar">
            <span class="p-input-icon-left w-full">
              <i class="pi pi-search"></i>
              <input 
                pInputText 
                class="w-full" 
                [(ngModel)]="searchQuery" 
                placeholder="Search by title or leader..." 
                type="text">
            </span>
            <p-button 
              icon="pi pi-plus"
              label="Create Collaboration"
              (onClick)="createCollaboration()"
              severity="primary">
            </p-button>
          </div>

          @if (filteredCollaborations().length === 0) {
            <div class="empty-state">
              <i class="pi pi-users text-4xl"></i>
              <h3>No Collaborations Found</h3>
              <p>Start a new global research collaboration</p>
              <p-button 
                icon="pi pi-plus"
                label="Create Collaboration"
                (onClick)="createCollaboration()"
                severity="primary">
              </p-button>
            </div>
          } @else {
            <div class="collaborations-list">
              @for (collab of filteredCollaborations(); track collab.id) {
                <p-card class="collaboration-card">
                  <div class="collaboration-header">
                    <div class="collab-title">
                      <h3>{{ getCollaborationTitle(collab) }}</h3>
                      <p-chip [label]="collab.status" [style]="{'background-color': getCollaborationStatusColor(collab.status)}" class="status-chip"></p-chip>
                    </div>
                    <div class="language-badges">
                      @for (lang of collab.languages.slice(0, 5); track lang) {
                        <p-chip class="language-chip" [label]="getLanguageFlag(lang)" [pTooltip]="getLanguageName(lang)"></p-chip>
                      }
                    </div>
                  </div>

                  <div class="collaboration-body">
                    <p class="description">{{ truncateText(getCollaborationDescription(collab), 150) }}</p>

                    <div class="collab-meta">
                      <div class="meta-row">
                        <i class="pi pi-user"></i>
                        <span><strong>Leader:</strong> {{ collab.leader.name }} ({{ collab.leader.country }})</span>
                      </div>
                      <div class="meta-row">
                        <i class="pi pi-users"></i>
                        <span><strong>Team Size:</strong> {{ collab.members.length + 1 }} members</span>
                      </div>
                      <div class="meta-row">
                        <i class="pi pi-tag"></i>
                        <span><strong>Field:</strong> {{ collab.field }}</span>
                      </div>
                      <div class="meta-row">
                        <i class="pi pi-globe"></i>
                        <span><strong>Regions:</strong> {{ collab.regions.join(', ') }}</span>
                      </div>
                      <div class="meta-row">
                        <i class="pi pi-calendar"></i>
                        <span><strong>Started:</strong> {{ formatDate(collab.startDate) }}</span>
                      </div>
                    </div>

                    <div class="objectives">
                      <strong>Objectives:</strong>
                      <ul>
                        @for (objective of collab.objectives.slice(0, 3); track objective) {
                          <li>{{ objective }}</li>
                        }
                      </ul>
                    </div>

                    <div class="tags">
                      @for (tag of collab.tags; track tag) {
                        <p-chip class="tag-chip" [label]="tag"></p-chip>
                      }
                    </div>
                  </div>

                  <div class="collaboration-actions">
                    <p-button icon="pi pi-eye" label="View Details" (onClick)="viewCollaboration(collab)"></p-button>
                    @if (collab.status === 'active' || collab.status === 'planning') {
                      <p-button icon="pi pi-user-plus" label="Join Collaboration" (onClick)="joinCollaboration(collab)" severity="primary"></p-button>
                    }
                  </div>
                </p-card>
              }
            </div>
          }
        </div>
        </p-tabPanel>

      <!-- Language Statistics Tab -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <i class="pi pi-chart-bar mr-2"></i>
          <span>Statistics</span>
        </ng-template>

        <div class="tab-content">
          <div class="statistics-grid">
            <!-- Papers by Language -->
            <p-card class="stats-card">
              <ng-template pTemplate="header">
                <div class="flex align-items-center gap-2">
                  <i class="pi pi-globe"></i>
                  <span>Papers by Language</span>
                </div>
              </ng-template>
              <div class="stat-list">
                @for (entry of paperStats().byLanguage | keyvalue; track entry.key) {
                  <div class="stat-row">
                    <span class="stat-label">
                      {{ entry.key }}
                    </span>
                    <p-badge [value]="entry.value.toString()" severity="info"></p-badge>
                  </div>
                }
              </div>
            </p-card>

            <!-- Papers by Field -->
            <p-card class="stats-card">
              <ng-template pTemplate="header">
                <div class="flex align-items-center gap-2">
                  <i class="pi pi-tag"></i>
                  <span>Papers by Field</span>
                </div>
              </ng-template>
              <div class="stat-list">
                @for (entry of paperStats().byField | keyvalue; track entry.key) {
                  <div class="stat-row">
                    <span class="stat-label">{{ entry.key }}</span>
                    <p-badge [value]="entry.value.toString()" severity="info"></p-badge>
                  </div>
                }
              </div>
            </p-card>

            <!-- Papers by Region -->
            <p-card class="stats-card">
              <ng-template pTemplate="header">
                <div class="flex align-items-center gap-2">
                  <i class="pi pi-map"></i>
                  <span>Papers by Region</span>
                </div>
              </ng-template>
              <div class="stat-list">
                @for (entry of paperStats().byRegion | keyvalue; track entry.key) {
                  <div class="stat-row">
                    <span class="stat-label">{{ entry.key }}</span>
                    <p-badge [value]="entry.value.toString()" severity="info"></p-badge>
                  </div>
                }
              </div>
            </p-card>

            <!-- Collaboration Statistics -->
            <p-card class="stats-card">
              <ng-template pTemplate="header">
                <div class="flex align-items-center gap-2">
                  <i class="pi pi-users"></i>
                  <span>Collaboration Stats</span>
                </div>
              </ng-template>
              <div class="stat-list">
                <div class="stat-row">
                  <span class="stat-label">Total Collaborations</span>
                  <p-badge [value]="collaborationStats().totalCollaborations.toString()" severity="info"></p-badge>
                </div>
                <div class="stat-row">
                  <span class="stat-label">Active</span>
                  <p-badge [value]="collaborationStats().activeCollaborations.toString()" severity="success"></p-badge>
                </div>
                <div class="stat-row">
                  <span class="stat-label">Average Team Size</span>
                  <p-badge [value]="((collaborationStats().averageTeamSize) || 0) | number:'1.1-1'" severity="info"></p-badge>
                </div>
                <div class="stat-row">
                  <span class="stat-label">Open Access Rate</span>
                  <p-badge [value]="(paperStats().openAccessPercentage | number:'1.0-0') + '%'" severity="warning"></p-badge>
                </div>
              </div>
            </p-card>
          </div>
        </div>
      </p-tabPanel>
    </p-tabView>
  </p-card>
</div>
