<div class="trust-layer-container">
  <!-- Header -->
  <p-card class="header-card">
    <div class="header-content">
      <div class="header-text">
        <h1>
          <span class="pi pi-shield header-icon"></span>
          TrustLayer
        </h1>
        <p>Verification & Provenance System</p>
      </div>
      <button pButton label="Create Verification" icon="pi pi-plus" (click)="verifyEntity('new', 'paper')" class="p-button-primary"></button>
    </div>
  </p-card>

  <!-- Statistics Dashboard -->
  <div class="stats-grid">
    <p-card class="stat-card" *ngFor="let stat of [
        {icon: 'pi pi-check-circle', value: verificationStats().verifiedCount, label: 'Verified'},
        {icon: 'pi pi-clock', value: verificationStats().pendingCount, label: 'Pending'},
        {icon: 'pi pi-users', value: peerVerificationStats().totalReviews, label: 'Peer Reviews'},
        {icon: 'pi pi-exclamation-triangle', value: fraudStats().openAlerts, label: 'Active Alerts'}
      ]">
      <div class="stat-content">
        <span [class]="'pi ' + stat.icon + ' stat-icon'"></span>
        <div class="stat-info">
          <div class="stat-value">{{ stat.value }}</div>
          <div class="stat-label">{{ stat.label }}</div>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Main Content Tabs -->
  <p-card class="content-card">
    <p-tabView>
      <!-- Blockchain Verifications Tab -->
      <p-tabPanel header="Blockchain Verifications" [selected]="true" leftIcon="pi pi-link">
        <div class="tab-content">
          <!-- Search and Filter Toolbar -->
          <div class="toolbar">
            <span class="p-input-icon-left search-field">
              <i class="pi pi-search"></i>
              <input pInputText [(ngModel)]="searchQuery" (input)="searchVerifications()" placeholder="Search by entity ID, verifier..." />
            </span>

            <p-multiSelect
              [options]="statusOptions"
              [(ngModel)]="selectedStatuses"
              placeholder="Select Status"
              optionLabel="label"
              optionValue="value"
              (onChange)="searchVerifications()">
              <ng-template let-status pTemplate="item">
                <p-tag [value]="status.label" [severity]="status.value"></p-tag>
              </ng-template>
            </p-multiSelect>

            <p-multiSelect
              [options]="entityTypeOptions"
              [(ngModel)]="selectedEntityTypes"
              placeholder="Select Entity Type"
              optionLabel="label"
              optionValue="value"
              (onChange)="searchVerifications()">
              <ng-template let-type pTemplate="item">
                <i class="pi pi-{{ getEntityTypeIcon(type.value) }} mr-2"></i>
                <span>{{ type.label }}</span>
              </ng-template>
            </p-multiSelect>

            <p-multiSelect
              [options]="methodOptions"
              [(ngModel)]="selectedMethods"
              placeholder="Select Method"
              optionLabel="label"
              optionValue="value"
              (onChange)="searchVerifications()">
              <ng-template let-method pTemplate="item">
                <i class="pi pi-{{ getMethodIcon(method.value) }} mr-2"></i>
                <span>{{ method.label }}</span>
              </ng-template>
            </p-multiSelect>
          </div>

          <!-- Verifications List -->
          <div *ngIf="isLoading()" class="loading-container">
            <p-progressSpinner></p-progressSpinner>
            <p>Loading verifications...</p>
          </div>

          <div *ngIf="!isLoading() && filteredVerifications().length === 0" class="empty-state">
            <span class="pi pi-check-circle"></span>
            <h3>No Verifications Found</h3>
            <p>Start by creating your first blockchain verification</p>
            <button pButton label="Create Verification" icon="pi pi-plus" (click)="verifyEntity('new', 'paper')" class="p-button-primary"></button>
          </div>

          <div *ngIf="!isLoading() && filteredVerifications().length > 0" class="verifications-list">
            <p-card *ngFor="let verification of filteredVerifications()" class="verification-card">
              <div class="verification-header">
                <div class="verification-title">
                  <span [class]="'pi ' + getEntityTypeIcon(verification.entityType) + ' entity-icon'"></span>
                  <div>
                    <h3>{{ verification.entityId }}</h3>
                    <p class="meta">{{ verification.entityType }} • {{ formatDateTime(verification.timestamp) }}</p>
                  </div>
                </div>
                <p-chip [style.background-color]="getStatusColor(verification.status)" class="status-chip" [label]="verification.status" [icon]="getStatusIcon(verification.status)"></p-chip>
              </div>

              <div class="verification-body">
                <div class="verification-info">
                  <div class="info-row">
                    <span class="label">Verifier:</span>
                    <span class="value">{{ verification.verifier }}</span>
                  </div>
                  <div *ngIf="verification.verifierOrganization" class="info-row">
                    <span class="label">Organization:</span>
                    <span class="value">{{ verification.verifierOrganization }}</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Method:</span>
                    <span class="value">
                      <span [class]="'pi ' + getMethodIcon(verification.verificationMethod) + ' inline-icon'"></span>
                      {{ verification.verificationMethod }}
                    </span>
                  </div>
                  <div class="info-row">
                    <span class="label">Blockchain Hash:</span>
                    <span class="value hash" pTooltip="{{ verification.blockchainHash }}">
                      {{ formatHash(verification.blockchainHash) }}
                    </span>
                  </div>
                  <div class="info-row">
                    <span class="label">Transaction ID:</span>
                    <span class="value">{{ verification.transactionId }}</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Integrity Score:</span>
                    <p-chip [style.background-color]="verification.metadata.integrityScore >= 90 ? '#4caf50' : verification.metadata.integrityScore >= 70 ? '#ff9800' : '#f44336'"
                            [label]="verification.metadata.integrityScore + '/100'"
                            class="integrity-chip">
                    </p-chip>
                  </div>
                </div>

                <div class="verification-actions">
                  <button pButton label="View Details" icon="pi pi-eye" (click)="viewVerification(verification)" class="p-button-text"></button>

                  <p-splitButton icon="pi pi-ellipsis-v"
                                 [model]="[
                                   {label: 'Copy Hash', icon: 'pi pi-copy'},
                                   {label: 'Download Certificate', icon: 'pi pi-download'},
                                   {label: 'Share Verification', icon: 'pi pi-share-alt'}
                                 ]">
                  </p-splitButton>
                </div>
              </div>
            </p-card>
          </div>
        </div>
      </p-tabPanel>

      <!-- Peer Reviews -->
      <p-tabPanel header="Peer Reviews" leftIcon="pi pi-users">
        <div class="tab-content">
          <div class="toolbar">
            <button pButton label="Submit Peer Review" icon="pi pi-plus" (click)="submitPeerReview()" class="p-button-primary"></button>
          </div>

          <div *ngIf="peerVerifications().length === 0" class="empty-state">
            <span class="pi pi-users"></span>
            <h3>No Peer Reviews Yet</h3>
            <p>Be the first to contribute a peer verification</p>
          </div>

          <div *ngIf="peerVerifications().length > 0" class="peer-reviews-list">
            <p-card *ngFor="let review of peerVerifications()" class="peer-review-card">
              <div class="review-header">
                <div class="review-title">
                  <span [class]="'pi ' + getEntityTypeIcon(review.subjectType)"></span>
                  <div>
                    <h3>{{ review.subjectTitle }}</h3>
                    <p class="meta">
                      Reviewed by {{ review.verifierName }} • {{ formatDate(review.verificationDate) }}
                    </p>
                  </div>
                </div>
                <p-chip *ngIf="review.badge" [style.background-color]="review.badge.color" [label]="review.badge.level" [icon]="review.badge.icon"></p-chip>
              </div>

              <div class="review-body">
                <div class="review-metrics">
                  <div class="metric" *ngFor="let m of [
                    {label: 'Confidence', value: review.confidence + '%'},
                    {label: 'Result', value: review.result},
                    {label: 'Duration', value: review.reviewDuration + 'h'},
                    {label: 'Verifications', value: review.verifierCredentials.verificationCount}
                  ]">
                    <span class="metric-label">{{ m.label }}</span>
                    <span class="metric-value">{{ m.value }}</span>
                  </div>
                </div>

                <div class="review-findings">
                  <h4>Findings ({{ review.findings.length }})</h4>
                  <div *ngFor="let finding of review.findings" class="finding" [style.border-left-color]="getSeverityColor(finding.severity)">
                    <div class="finding-header">
                      <p-chip [style.background-color]="getSeverityColor(finding.severity)" [label]="finding.severity"></p-chip>
                      <span class="finding-category">{{ finding.category }}</span>
                    </div>
                    <h5>{{ finding.title }}</h5>
                    <p>{{ finding.description }}</p>
                    <p *ngIf="finding.suggestion" class="suggestion">
                      <span class="pi pi-lightbulb"></span>
                      {{ finding.suggestion }}
                    </p>
                  </div>
                </div>

                <button pButton label="View Full Report" icon="pi pi-eye" (click)="viewPeerVerification(review)" class="p-button-text"></button>
              </div>
            </p-card>
          </div>
        </div>
      </p-tabPanel>

      <!-- Reputation -->
      <p-tabPanel header="Reputation" leftIcon="pi pi-chart-line">
        <div class="tab-content">
          <div *ngIf="reputationProfiles().length === 0" class="empty-state">
            <span class="pi pi-chart-line"></span>
            <h3>No Reputation Data</h3>
            <p>Start contributing to build your reputation</p>
          </div>

          <div *ngIf="reputationProfiles().length > 0" class="reputation-list">
            <p-card *ngFor="let profile of reputationProfiles()" class="reputation-card">
              <div class="reputation-header">
                <div class="rank-badge">{{ profile.rank }}</div>
                <div class="profile-info">
                  <h3>{{ profile.userName }}</h3>
                  <p-chip [label]="profile.level" class="level-chip"></p-chip>
                </div>
                <div class="score">
                  <span class="score-value">{{ profile.overallScore }}</span>
                  <span class="score-label">points</span>
                </div>
              </div>

              <div class="reputation-metrics">
                <div class="metric-item">
                  <span class="pi pi-check-circle"></span>
                  <span>{{ profile.metrics.publicationsVerified }} Publications</span>
                </div>
                <div class="metric-item">
                  <span class="pi pi-database"></span>
                  <span>{{ profile.metrics.datasetsVerified }} Datasets</span>
                </div>
                <div class="metric-item">
                  <span class="pi pi-users"></span>
                  <span>{{ profile.metrics.peerReviewsCompleted }} Reviews</span>
                </div>
                <div class="metric-item">
                  <span class="pi pi-quote-right"></span>
                  <span>{{ profile.metrics.citations }} Citations</span>
                </div>
              </div>

              <div class="badges-section">
                <p-chip *ngFor="let achievement of profile.achievements" [label]="achievement.name" [icon]="achievement.icon" pTooltip="{{ achievement.description }}" class="achievement-chip"></p-chip>
              </div>

              <button pButton label="View Profile" icon="pi pi-eye" (click)="viewReputationProfile(profile)" class="p-button-text"></button>
            </p-card>
          </div>
        </div>
      </p-tabPanel>

      <!-- Fraud Alerts -->
      <p-tabPanel header="Fraud Alerts" leftIcon="pi pi-exclamation-triangle">
        <div class="tab-content">
          <div class="toolbar">
            <button pButton label="Report Fraud" icon="pi pi-flag" class="p-button-danger" (click)="reportFraud()"></button>
          </div>

          <div *ngIf="fraudAlerts().length === 0" class="empty-state">
            <span class="pi pi-shield"></span>
            <h3>No Active Alerts</h3>
            <p>All clear! No fraud alerts at this time.</p>
          </div>

          <div *ngIf="fraudAlerts().length > 0" class="fraud-alerts-list">
            <p-card *ngFor="let alert of filteredFraudAlerts()" class="fraud-alert-card" [ngClass]="{'critical': alert.severity === 'critical'}">
              <div class="alert-header">
                <span [class]="'pi pi-exclamation-triangle'" [style.color]="getSeverityColor(alert.severity)"></span>
                <div class="alert-title">
                  <h3>{{ alert.entityTitle }}</h3>
                  <p class="meta">{{ alert.alertType }} • {{ formatDateTime(alert.detectedAt) }}</p>
                </div>
                <p-chip [style.background-color]="getSeverityColor(alert.severity)" [label]="alert.severity"></p-chip>
              </div>

              <div class="alert-body">
                <div class="alert-info">
                  <div class="info-row">
                    <span class="label">Detection Method:</span>
                    <span class="value">{{ alert.detectionMethod }}</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Confidence:</span>
                    <span class="value">{{ alert.confidence }}%</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Status:</span>
                    <span class="value">{{ alert.status }}</span>
                  </div>
                  <div *ngIf="alert.investigator" class="info-row">
                    <span class="label">Investigator:</span>
                    <span class="value">{{ alert.investigator }}</span>
                  </div>
                </div>

                <div class="indicators-section">
                  <h4>Indicators ({{ alert.indicators.length }})</h4>
                  <div *ngFor="let indicator of alert.indicators" class="indicator">
                    <div class="indicator-header">
                      <span class="indicator-type">{{ indicator.type }}</span>
                      <span class="indicator-weight">Weight: {{ indicator.weight }}%</span>
                    </div>
                    <p>{{ indicator.description }}</p>
                    <p class="evidence">Evidence: {{ indicator.evidence }}</p>
                  </div>
                </div>

                <button pButton label="View Full Report" icon="pi pi-eye" class="p-button-danger p-button-text" (click)="viewFraudAlert(alert)"></button>
              </div>
            </p-card>
          </div>
        </div>
      </p-tabPanel>
    </p-tabView>
  </p-card>
</div>
